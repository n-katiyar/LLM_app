{"version":3,"file":"useHvBulkActions.js","sources":["../../../../src/Table/hooks/useHvBulkActions.ts"],"sourcesContent":["import { useCallback } from \"react\";\nimport {\n  ensurePluginOrder,\n  Hooks,\n  makePropGetter,\n  PropGetter,\n  TableCommonProps,\n  useGetLatest,\n} from \"react-table\";\n\n// #region ##### TYPES #####\n\n// TODO: fix typo in v6\nexport interface HvTAbleBulkActionsProps extends TableCommonProps {\n  numTotal: number;\n  numSelected: number;\n  showSelectAllPages: boolean;\n  onSelectAll: () => void;\n  onSelectAllPages: () => void;\n  labels?: Record<string, string>;\n}\n\nexport type HvBulkActionsPropGetter<D extends object> = PropGetter<\n  D,\n  HvTAbleBulkActionsProps\n>;\n\nexport interface UseHvBulkActionsHooks<D extends object> {\n  getHvBulkActionsProps: Array<HvBulkActionsPropGetter<D>>;\n}\n\nexport type UseHvBulkActionsTableOptions = {\n  // TODO: fix typo in v6\n  /** Controls whether the \"Select all\" should _select_ or _unselect_ the rows, in a partial selection state. */\n  aditivePageBulkSelection?: boolean;\n  /** Controls whether _only the current page_ or _all pages_ should be unselected */\n  subtractivePageBulkDeselection?: boolean;\n  showSelectAllPages?: boolean;\n};\n\nexport interface UseHvBulkActionsTableInstanceProps<D extends object> {\n  getHvBulkActionsProps: (\n    propGetter?: HvBulkActionsPropGetter<D>,\n  ) => HvTAbleBulkActionsProps;\n  invertedToggleAllRowsSelected: () => void;\n}\n\nexport type UseBulkActionsProps = (<D extends object = Record<string, unknown>>(\n  hooks: Hooks<D>,\n) => void) & { pluginName: string };\n\n// #endregion ##### TYPES #####\n\nconst useInstanceHook = (instance: any) => {\n  const { plugins, page, toggleAllPageRowsSelected, toggleAllRowsSelected } =\n    instance;\n\n  ensurePluginOrder(plugins, [\"useHvRowSelection\"], \"useHvBulkActions\");\n\n  const getInstance = useGetLatest(instance);\n\n  const getHvBulkActionsProps = makePropGetter(\n    instance.getHooks().getHvBulkActionsProps,\n    {\n      instance: getInstance(),\n    },\n  );\n\n  const isPaginated = !!page;\n\n  const invertedToggleAllRowsSelected = useCallback(() => {\n    if (!isPaginated) return toggleAllRowsSelected();\n\n    const {\n      aditivePageBulkSelection: additivePageBulkSelection,\n      subtractivePageBulkDeselection,\n      isNoRowsSelected,\n      isNoPageRowsSelected,\n      isAllSelectablePageRowsSelected,\n      isAllSelectablePageRowsUnselected,\n    } = getInstance();\n\n    if (additivePageBulkSelection && subtractivePageBulkDeselection) {\n      return toggleAllPageRowsSelected(!isAllSelectablePageRowsSelected);\n    }\n\n    if (additivePageBulkSelection && !subtractivePageBulkDeselection) {\n      if (!isAllSelectablePageRowsSelected) {\n        return toggleAllPageRowsSelected(true);\n      }\n\n      return toggleAllRowsSelected(false);\n    }\n\n    if (!additivePageBulkSelection && !subtractivePageBulkDeselection) {\n      if (isNoRowsSelected) {\n        return toggleAllPageRowsSelected(true);\n      }\n\n      return toggleAllRowsSelected(false);\n    }\n\n    if (!additivePageBulkSelection && subtractivePageBulkDeselection) {\n      if (isNoRowsSelected) {\n        return toggleAllPageRowsSelected(true);\n      }\n      if (!isAllSelectablePageRowsUnselected) {\n        return toggleAllPageRowsSelected(false);\n      }\n      if (!isNoPageRowsSelected) {\n        return toggleAllPageRowsSelected(false);\n      }\n\n      return toggleAllRowsSelected(false);\n    }\n\n    return toggleAllPageRowsSelected();\n  }, [\n    getInstance,\n    isPaginated,\n    toggleAllPageRowsSelected,\n    toggleAllRowsSelected,\n  ]);\n\n  Object.assign(instance, {\n    getHvBulkActionsProps,\n    invertedToggleAllRowsSelected,\n    aditivePageBulkSelection: !!instance.aditivePageBulkSelection,\n    subtractivePageBulkDeselection: !!instance.subtractivePageBulkDeselection,\n  });\n};\n\nconst defaultGetHvBulkActionsProps = (props: any, { instance }: any) => {\n  const {\n    rows,\n    initialRows,\n    selectedFlatRows,\n    state: { selectedRowIds = {} } = {},\n    page,\n    toggleAllRowsSelected,\n    invertedToggleAllRowsSelected,\n    showSelectAllPages = true,\n    applyToggleAllRowsSelectedToPrefilteredRows,\n  } = instance;\n\n  const isPaginated = !!page;\n\n  const nextProps: HvTAbleBulkActionsProps = {\n    numTotal: applyToggleAllRowsSelectedToPrefilteredRows\n      ? initialRows.length\n      : rows.length,\n    numSelected: applyToggleAllRowsSelectedToPrefilteredRows\n      ? Object.keys(selectedRowIds).length\n      : selectedFlatRows.length,\n    showSelectAllPages: showSelectAllPages && isPaginated,\n    onSelectAll: invertedToggleAllRowsSelected,\n    onSelectAllPages: toggleAllRowsSelected,\n  };\n\n  return [props, nextProps];\n};\n\nexport const useHvBulkActions: UseBulkActionsProps = (hooks) => {\n  hooks.getHvBulkActionsProps = [defaultGetHvBulkActionsProps];\n\n  hooks.useInstance.push(useInstanceHook);\n};\n\nuseHvBulkActions.pluginName = \"useHvBulkActions\";\n"],"names":[],"mappings":";;AAqDA,MAAM,kBAAkB,CAAC,aAAkB;AACzC,QAAM,EAAE,SAAS,MAAM,2BAA2B,sBAChD,IAAA;AAEF,oBAAkB,SAAS,CAAC,mBAAmB,GAAG,kBAAkB;AAE9D,QAAA,cAAc,aAAa,QAAQ;AAEzC,QAAM,wBAAwB;AAAA,IAC5B,SAAS,WAAW;AAAA,IACpB;AAAA,MACE,UAAU,YAAY;AAAA,IAAA;AAAA,EAE1B;AAEM,QAAA,cAAc,CAAC,CAAC;AAEhB,QAAA,gCAAgC,YAAY,MAAM;AAClD,QAAA,CAAC,YAAa,QAAO,sBAAsB;AAEzC,UAAA;AAAA,MACJ,0BAA0B;AAAA,MAC1B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,QACE,YAAY;AAEhB,QAAI,6BAA6B,gCAAgC;AACxD,aAAA,0BAA0B,CAAC,+BAA+B;AAAA,IAAA;AAG/D,QAAA,6BAA6B,CAAC,gCAAgC;AAChE,UAAI,CAAC,iCAAiC;AACpC,eAAO,0BAA0B,IAAI;AAAA,MAAA;AAGvC,aAAO,sBAAsB,KAAK;AAAA,IAAA;AAGhC,QAAA,CAAC,6BAA6B,CAAC,gCAAgC;AACjE,UAAI,kBAAkB;AACpB,eAAO,0BAA0B,IAAI;AAAA,MAAA;AAGvC,aAAO,sBAAsB,KAAK;AAAA,IAAA;AAGhC,QAAA,CAAC,6BAA6B,gCAAgC;AAChE,UAAI,kBAAkB;AACpB,eAAO,0BAA0B,IAAI;AAAA,MAAA;AAEvC,UAAI,CAAC,mCAAmC;AACtC,eAAO,0BAA0B,KAAK;AAAA,MAAA;AAExC,UAAI,CAAC,sBAAsB;AACzB,eAAO,0BAA0B,KAAK;AAAA,MAAA;AAGxC,aAAO,sBAAsB,KAAK;AAAA,IAAA;AAGpC,WAAO,0BAA0B;AAAA,EAAA,GAChC;AAAA,IACD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAED,SAAO,OAAO,UAAU;AAAA,IACtB;AAAA,IACA;AAAA,IACA,0BAA0B,CAAC,CAAC,SAAS;AAAA,IACrC,gCAAgC,CAAC,CAAC,SAAS;AAAA,EAAA,CAC5C;AACH;AAEA,MAAM,+BAA+B,CAAC,OAAY,EAAE,eAAoB;AAChE,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,OAAO,EAAE,iBAAiB,CAAC,EAAA,IAAM,CAAC;AAAA,IAClC;AAAA,IACA;AAAA,IACA;AAAA,IACA,qBAAqB;AAAA,IACrB;AAAA,EAAA,IACE;AAEE,QAAA,cAAc,CAAC,CAAC;AAEtB,QAAM,YAAqC;AAAA,IACzC,UAAU,8CACN,YAAY,SACZ,KAAK;AAAA,IACT,aAAa,8CACT,OAAO,KAAK,cAAc,EAAE,SAC5B,iBAAiB;AAAA,IACrB,oBAAoB,sBAAsB;AAAA,IAC1C,aAAa;AAAA,IACb,kBAAkB;AAAA,EACpB;AAEO,SAAA,CAAC,OAAO,SAAS;AAC1B;AAEa,MAAA,mBAAwC,CAAC,UAAU;AACxD,QAAA,wBAAwB,CAAC,4BAA4B;AAErD,QAAA,YAAY,KAAK,eAAe;AACxC;AAEA,iBAAiB,aAAa;"}