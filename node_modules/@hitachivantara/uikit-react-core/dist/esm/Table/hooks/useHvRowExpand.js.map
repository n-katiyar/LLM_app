{"version":3,"file":"useHvRowExpand.js","sources":["../../../../src/Table/hooks/useHvRowExpand.tsx"],"sourcesContent":["import {\n  Hooks,\n  TableExpandedToggleProps,\n  UseExpandedRowProps,\n} from \"react-table\";\nimport { DropDownXS } from \"@hitachivantara/uikit-react-icons\";\n\nimport { HvButton } from \"../../Button\";\nimport { useLabels } from \"../../hooks/useLabels\";\nimport { HvTypography } from \"../../Typography\";\nimport { DefaultCell } from \"../renderers/DefaultCell\";\nimport type { HvCellProps } from \"./useHvTable\";\n\n// #region ##### TYPES #####\n\nexport interface UseHvRowExpandTableRowProps {\n  expanded?: boolean;\n}\n\nexport type UseHvRowExpandTableOptions = {\n  disableCreateExpandButton?: boolean;\n};\n\nexport interface UseHvRowExpandRowToggleProps extends TableExpandedToggleProps {\n  onClick?: React.MouseEventHandler<unknown>;\n}\n\nexport interface UseHvRowExpandRowInstance<\n  D extends object = Record<string, unknown>,\n> extends UseExpandedRowProps<D> {\n  getToggleRowExpandedProps: (\n    props?: Partial<TableExpandedToggleProps>,\n  ) => UseHvRowExpandRowToggleProps;\n}\n\nexport type UseRowExpandProps = (<D extends object = Record<string, unknown>>(\n  hooks: Hooks<D>,\n) => void) & { pluginName: string };\n\n// #endregion ##### TYPES #####\n\nconst DEFAULT_LABELS = {\n  expandRowButtonAriaLabel: \"Expand this row\",\n  collapseRowButtonAriaLabel: \"Collapse this row\",\n};\n\nexport const CellWithExpandButton = ({\n  row,\n  cell,\n  labels: labelsProp,\n}: HvCellProps<any>) => {\n  const labels = useLabels(DEFAULT_LABELS, labelsProp);\n  const rowProps = row.getToggleRowExpandedProps?.();\n\n  return (\n    <>\n      <HvButton\n        icon\n        aria-label={\n          row.isExpanded\n            ? labels.collapseRowButtonAriaLabel\n            : labels.expandRowButtonAriaLabel\n        }\n        aria-expanded={row.isExpanded}\n        onClick={rowProps?.onClick}\n      >\n        <DropDownXS rotate={row.isExpanded} />\n      </HvButton>\n      {cell?.value && (\n        <HvTypography variant=\"label\" component=\"span\">\n          {cell.value}\n        </HvTypography>\n      )}\n    </>\n  );\n};\n\nconst visibleColumnsHook = (columns: any, { instance }: any) => {\n  if (instance.disableCreateExpandButton) {\n    return columns;\n  }\n\n  // add a button to first data column, unless it has a custom renderer\n  // if so, add an extra column instead\n  const firstDataColumnIndex = columns.findIndex(\n    (c: any) => c.id?.indexOf(\"_hv_\") !== 0,\n  );\n\n  if (firstDataColumnIndex !== -1) {\n    const firstDataColumn = columns[firstDataColumnIndex];\n\n    if (firstDataColumn.Cell == null || firstDataColumn.Cell !== DefaultCell) {\n      firstDataColumn.Cell = CellWithExpandButton;\n      firstDataColumn.variant = \"expand\";\n\n      return columns;\n    }\n  }\n\n  const expandColumn = {\n    id: \"_hv_expand\",\n    variant: \"none\",\n\n    width: 32,\n\n    // this will only work when using useHvTableSticky\n    // but ensures it stays left of any sticky column\n    sticky: \"left\",\n\n    Cell: CellWithExpandButton,\n  };\n\n  const columnsCopy = [...columns];\n  columnsCopy.splice(\n    firstDataColumnIndex !== -1 ? firstDataColumnIndex : 0,\n    0,\n    expandColumn,\n  );\n\n  return columnsCopy;\n};\n\nconst getRowPropsHook = (props: any, { row }: any) => {\n  const nextProps: UseHvRowExpandTableRowProps = {\n    expanded: row.isExpanded,\n  };\n\n  return [props, nextProps];\n};\n\nexport const useHvRowExpand: UseRowExpandProps = (hooks) => {\n  hooks.visibleColumns.push(visibleColumnsHook);\n  hooks.getRowProps.push(getRowPropsHook);\n};\nuseHvRowExpand.pluginName = \"useHvRowExpand\";\n"],"names":[],"mappings":";;;;;;AAyCA,MAAM,iBAAiB;AAAA,EACrB,0BAA0B;AAAA,EAC1B,4BAA4B;AAC9B;AAEO,MAAM,uBAAuB,CAAC;AAAA,EACnC;AAAA,EACA;AAAA,EACA,QAAQ;AACV,MAAwB;AAChB,QAAA,SAAS,UAAU,gBAAgB,UAAU;AAC7C,QAAA,WAAW,IAAI,4BAA4B;AAEjD,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAI;AAAA,QACJ,cACE,IAAI,aACA,OAAO,6BACP,OAAO;AAAA,QAEb,iBAAe,IAAI;AAAA,QACnB,SAAS,UAAU;AAAA,QAEnB,UAAC,oBAAA,YAAA,EAAW,QAAQ,IAAI,WAAY,CAAA;AAAA,MAAA;AAAA,IACtC;AAAA,IACC,MAAM,SACJ,oBAAA,cAAA,EAAa,SAAQ,SAAQ,WAAU,QACrC,UAAA,KAAK,MACR,CAAA;AAAA,EAAA,GAEJ;AAEJ;AAEA,MAAM,qBAAqB,CAAC,SAAc,EAAE,eAAoB;AAC9D,MAAI,SAAS,2BAA2B;AAC/B,WAAA;AAAA,EAAA;AAKT,QAAM,uBAAuB,QAAQ;AAAA,IACnC,CAAC,MAAW,EAAE,IAAI,QAAQ,MAAM,MAAM;AAAA,EACxC;AAEA,MAAI,yBAAyB,IAAI;AACzB,UAAA,kBAAkB,QAAQ,oBAAoB;AAEpD,QAAI,gBAAgB,QAAQ,QAAQ,gBAAgB,SAAS,aAAa;AACxE,sBAAgB,OAAO;AACvB,sBAAgB,UAAU;AAEnB,aAAA;AAAA,IAAA;AAAA,EACT;AAGF,QAAM,eAAe;AAAA,IACnB,IAAI;AAAA,IACJ,SAAS;AAAA,IAET,OAAO;AAAA;AAAA;AAAA,IAIP,QAAQ;AAAA,IAER,MAAM;AAAA,EACR;AAEM,QAAA,cAAc,CAAC,GAAG,OAAO;AACnB,cAAA;AAAA,IACV,yBAAyB,KAAK,uBAAuB;AAAA,IACrD;AAAA,IACA;AAAA,EACF;AAEO,SAAA;AACT;AAEA,MAAM,kBAAkB,CAAC,OAAY,EAAE,UAAe;AACpD,QAAM,YAAyC;AAAA,IAC7C,UAAU,IAAI;AAAA,EAChB;AAEO,SAAA,CAAC,OAAO,SAAS;AAC1B;AAEa,MAAA,iBAAoC,CAAC,UAAU;AACpD,QAAA,eAAe,KAAK,kBAAkB;AACtC,QAAA,YAAY,KAAK,eAAe;AACxC;AACA,eAAe,aAAa;"}