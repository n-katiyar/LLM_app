{"version":3,"file":"DateTimeValue.js","sources":["../../../../../../src/QueryBuilder/Rule/Value/DateTimeValue/DateTimeValue.tsx"],"sourcesContent":["import { memo, useCallback, useMemo, useState } from \"react\";\nimport { useTheme } from \"@mui/material/styles\";\nimport useMediaQuery from \"@mui/material/useMediaQuery\";\nimport dayjs from \"dayjs\";\n\nimport { HvDatePicker } from \"../../../../DatePicker\";\nimport { HvWarningText } from \"../../../../FormElement\";\nimport { HvTimePicker, HvTimePickerValue } from \"../../../../TimePicker\";\nimport { uniqueId } from \"../../../../utils/helpers\";\nimport { useQueryBuilderContext } from \"../../../Context\";\nimport { useClasses } from \"./DateTimeValue.styles\";\nimport { padTime, parseDate, parseTime } from \"./utils\";\n\nfunction valueIsRange(operator?: string) {\n  return operator === \"range\";\n}\n\nexport interface DateTimeValueProps {\n  id: React.Key;\n  operator?: string;\n  value?: any;\n  initialTouched?: boolean;\n}\n\nexport const DateTimeValue = ({\n  id,\n  operator,\n  value: valueProp = {},\n  initialTouched = false,\n}: DateTimeValueProps) => {\n  const { classes, cx } = useClasses();\n\n  const theme = useTheme();\n  const isMdDown = useMediaQuery(theme.breakpoints.down(\"md\"));\n\n  const isRange = valueIsRange(operator);\n\n  const { labels, dispatchAction, readOnly } = useQueryBuilderContext();\n\n  const elementId = uniqueId(`datetime${id}`);\n\n  const [touchedDate, setTouchedDate] = useState(initialTouched);\n  const [touchedTime, setTouchedTime] = useState(initialTouched);\n  const [touchedEndDate, setTouchedEndDate] = useState(initialTouched);\n  const [touchedEndTime, setTouchedEndTime] = useState(initialTouched);\n\n  const onDateChange = useCallback(\n    (data?: Date) => {\n      setTouchedDate(true);\n\n      let date;\n      if (data != null) {\n        date = dayjs(data).format(\"YYYY-MM-DD\");\n      }\n\n      const oldValue = !isRange ? valueProp?.date : valueProp?.start?.date;\n\n      if (date !== oldValue) {\n        let value;\n        if (!isRange) {\n          value = {\n            date,\n            time: valueProp?.time,\n          };\n        } else {\n          value = {\n            start: {\n              date,\n              time: valueProp?.start?.time,\n            },\n            end: valueProp?.end,\n          };\n        }\n\n        dispatchAction({\n          type: \"set-value\",\n          id,\n          value,\n        });\n      }\n    },\n    [dispatchAction, id, isRange, valueProp],\n  );\n\n  const onTimeChange = useCallback(\n    (data: HvTimePickerValue) => {\n      setTouchedTime(true);\n\n      let time;\n      if (data != null) {\n        time = `${padTime(data.hours)}:${padTime(data.minutes)}:${padTime(\n          data.seconds,\n        )}`;\n      }\n\n      const oldValue = !isRange ? valueProp?.time : valueProp?.start?.time;\n\n      if (time !== oldValue) {\n        let value;\n        if (!isRange) {\n          value = {\n            date: valueProp?.date,\n            time,\n          };\n        } else {\n          value = {\n            start: {\n              date: valueProp?.start?.date,\n              time,\n            },\n            end: valueProp?.end,\n          };\n        }\n\n        dispatchAction({\n          type: \"set-value\",\n          id,\n          value,\n        });\n      }\n    },\n    [dispatchAction, id, isRange, valueProp],\n  );\n\n  const onEndDateChange = useCallback(\n    (data?: Date) => {\n      setTouchedEndDate(true);\n\n      let date;\n      if (data != null) {\n        date = dayjs(data).format(\"YYYY-MM-DD\");\n      }\n\n      if (date !== valueProp?.end?.date) {\n        const value = {\n          start: valueProp?.start,\n          end: {\n            date,\n            time: valueProp?.end?.time,\n          },\n        };\n\n        dispatchAction({\n          type: \"set-value\",\n          id,\n          value,\n        });\n      }\n    },\n    [dispatchAction, id, valueProp],\n  );\n\n  const onEndTimeChange = useCallback(\n    (data: HvTimePickerValue) => {\n      setTouchedEndTime(true);\n\n      let time;\n      if (data != null) {\n        time = `${padTime(data.hours)}:${padTime(data.minutes)}:${padTime(\n          data.seconds,\n        )}`;\n      }\n\n      if (time !== valueProp?.end?.time) {\n        const value = {\n          start: valueProp?.start,\n          end: {\n            date: valueProp?.end?.date,\n            time,\n          },\n        };\n\n        dispatchAction({\n          type: \"set-value\",\n          id,\n          value,\n        });\n      }\n    },\n    [dispatchAction, id, valueProp],\n  );\n\n  const startDate = isRange ? valueProp?.start?.date : valueProp?.date;\n  const datePickerValue = useMemo(() => parseDate(startDate), [startDate]);\n  const datePickerStatus = datePickerValue != null ? \"valid\" : \"invalid\";\n\n  const startTime = (isRange ? valueProp?.start?.time : valueProp?.time) ?? \"\";\n  const timePickerValue = useMemo(() => parseTime(startTime), [startTime]);\n  const timePickerStatus = timePickerValue != null ? \"valid\" : \"invalid\";\n\n  const endDate = isRange ? valueProp?.end?.date : null;\n  const endDatePickerValue = useMemo(() => parseDate(endDate), [endDate]);\n\n  const endTime = isRange ? valueProp?.end?.time : null;\n  const endTimePickerValue = useMemo(() => parseTime(endTime), [endTime]);\n\n  const dateStatus = !touchedDate ? \"standBy\" : datePickerStatus;\n  const timeStatus = !touchedTime ? \"standBy\" : timePickerStatus;\n\n  const endDateIsBefore =\n    startDate != null && endDate != null && endDate < startDate;\n\n  const endTimeIsBeforeOrSame =\n    startDate != null &&\n    endDate != null &&\n    endDate === startDate &&\n    startTime != null &&\n    endTime != null &&\n    endTime <= startTime;\n\n  const endDateTimeIsBefore = endDateIsBefore || endTimeIsBeforeOrSame;\n\n  const endDatePickerStatus =\n    endDatePickerValue == null || endDateTimeIsBefore ? \"invalid\" : \"valid\";\n  const endDateStatus = !touchedEndDate ? \"standBy\" : endDatePickerStatus;\n\n  const endTimePickerStatus =\n    endTimePickerValue == null || endDateTimeIsBefore ? \"invalid\" : \"valid\";\n  const endTimeStatus = !touchedEndTime ? \"standBy\" : endTimePickerStatus;\n\n  return (\n    <div className={classes.root}>\n      <div\n        className={cx(classes.row, classes.horizontal, {\n          [classes.isMdDown]: isMdDown,\n        })}\n      >\n        <HvDatePicker\n          className={classes.datePicker}\n          name={`${elementId}-date`}\n          required\n          status={dateStatus}\n          statusMessage={labels.rule.value.datetime.validation.required}\n          label={\n            isRange\n              ? labels.rule.value.datetime.startDateLabel\n              : labels.rule.value.datetime.dateLabel\n          }\n          placeholder={\n            isRange\n              ? labels.rule.value.datetime.startDatePlaceholder\n              : labels.rule.value.datetime.datePlaceholder\n          }\n          value={datePickerValue}\n          onChange={onDateChange}\n          readOnly={readOnly}\n        />\n        <HvTimePicker\n          className={classes.timePicker}\n          timeFormat=\"24\"\n          name={`${elementId}-time`}\n          required\n          status={timeStatus}\n          statusMessage={labels.rule.value.datetime.validation.required}\n          label={\n            isRange\n              ? labels.rule.value.datetime.startTimeLabel\n              : labels.rule.value.datetime.timeLabel\n          }\n          placeholder={\n            isRange\n              ? labels.rule.value.datetime.startTimePlaceholder\n              : labels.rule.value.datetime.timePlaceholder\n          }\n          value={timePickerValue || undefined}\n          onChange={onTimeChange}\n          onToggle={(_evt, open) => {\n            if (!open && !touchedTime) {\n              setTouchedTime(true);\n            }\n          }}\n          readOnly={readOnly}\n        />\n      </div>\n      {isRange && (\n        <div className={cx(classes.row, classes.vertical)}>\n          <div\n            className={cx(classes.horizontal, {\n              [classes.isMdDown]: isMdDown,\n            })}\n          >\n            <HvDatePicker\n              className={classes.datePicker}\n              name={`${elementId}-endDate`}\n              required\n              status={endDateStatus}\n              statusMessage={labels.rule.value.datetime.validation.required}\n              aria-errormessage={\n                endDateTimeIsBefore ? `${elementId}-combined-error` : undefined\n              }\n              label={labels.rule.value.datetime.endDateLabel}\n              placeholder={labels.rule.value.datetime.endDatePlaceholder}\n              value={endDatePickerValue}\n              onChange={onEndDateChange}\n              readOnly={readOnly}\n            />\n            <HvTimePicker\n              className={classes.timePicker}\n              timeFormat=\"24\"\n              name={`${elementId}-endTime`}\n              required\n              status={endTimeStatus}\n              statusMessage={labels.rule.value.datetime.validation.required}\n              aria-errormessage={\n                endDateTimeIsBefore ? `${elementId}-combined-error` : undefined\n              }\n              label={labels.rule.value.datetime.endTimeLabel}\n              placeholder={labels.rule.value.datetime.endTimePlaceholder}\n              value={endTimePickerValue || undefined}\n              onChange={onEndTimeChange}\n              onToggle={(_evt, open) => {\n                if (!open && !touchedEndTime) {\n                  setTouchedEndTime(true);\n                }\n              }}\n              readOnly={readOnly}\n            />\n          </div>\n          <HvWarningText\n            disableBorder\n            id={`${elementId}-combined-error`}\n            isVisible={endDateTimeIsBefore}\n          >\n            {labels.rule.value.datetime.validation.invalidInterval}\n          </HvWarningText>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(DateTimeValue);\n"],"names":[],"mappings":"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"}