{"version":3,"file":"TimerBasedCleanupTracking.js","sources":["../../../../../src/TreeView/internals/utils/TimerBasedCleanupTracking.ts"],"sourcesContent":["import {\n  CleanupTracking,\n  UnregisterToken,\n  UnsubscribeFn,\n} from \"./CleanupTracking\";\n\n// If no effect ran after this amount of time, we assume that the render was not committed by React\nconst CLEANUP_TIMER_LOOP_MILLIS = 1000;\n\nexport class TimerBasedCleanupTracking implements CleanupTracking {\n  timeouts? = new Map<number, NodeJS.Timeout>();\n\n  cleanupTimeout = CLEANUP_TIMER_LOOP_MILLIS;\n\n  constructor(timeout = CLEANUP_TIMER_LOOP_MILLIS) {\n    this.cleanupTimeout = timeout;\n  }\n\n  register(\n    object: any,\n    unsubscribe: UnsubscribeFn,\n    unregisterToken: UnregisterToken,\n  ): void {\n    if (!this.timeouts) {\n      this.timeouts = new Map<number, NodeJS.Timeout>();\n    }\n\n    const timeout = setTimeout(() => {\n      if (typeof unsubscribe === \"function\") {\n        unsubscribe();\n      }\n      this.timeouts!.delete(unregisterToken.cleanupToken);\n    }, this.cleanupTimeout);\n\n    this.timeouts!.set(unregisterToken!.cleanupToken, timeout);\n  }\n\n  unregister(unregisterToken: UnregisterToken): void {\n    const timeout = this.timeouts!.get(unregisterToken.cleanupToken);\n    if (timeout) {\n      this.timeouts!.delete(unregisterToken.cleanupToken);\n      clearTimeout(timeout);\n    }\n  }\n\n  reset() {\n    if (this.timeouts) {\n      this.timeouts.forEach((value, key) => {\n        this.unregister({ cleanupToken: key });\n      });\n      this.timeouts = undefined;\n    }\n  }\n}\n"],"names":[],"mappings":"AAOA,MAAM,4BAA4B;AAE3B,MAAM,0BAAqD;AAAA,EAChE,+BAAgB,IAA4B;AAAA,EAE5C,iBAAiB;AAAA,EAEjB,YAAY,UAAU,2BAA2B;AAC/C,SAAK,iBAAiB;AAAA,EAAA;AAAA,EAGxB,SACE,QACA,aACA,iBACM;AACF,QAAA,CAAC,KAAK,UAAU;AACb,WAAA,+BAAe,IAA4B;AAAA,IAAA;AAG5C,UAAA,UAAU,WAAW,MAAM;AAC3B,UAAA,OAAO,gBAAgB,YAAY;AACzB,oBAAA;AAAA,MAAA;AAET,WAAA,SAAU,OAAO,gBAAgB,YAAY;AAAA,IAAA,GACjD,KAAK,cAAc;AAEtB,SAAK,SAAU,IAAI,gBAAiB,cAAc,OAAO;AAAA,EAAA;AAAA,EAG3D,WAAW,iBAAwC;AACjD,UAAM,UAAU,KAAK,SAAU,IAAI,gBAAgB,YAAY;AAC/D,QAAI,SAAS;AACN,WAAA,SAAU,OAAO,gBAAgB,YAAY;AAClD,mBAAa,OAAO;AAAA,IAAA;AAAA,EACtB;AAAA,EAGF,QAAQ;AACN,QAAI,KAAK,UAAU;AACjB,WAAK,SAAS,QAAQ,CAAC,OAAO,QAAQ;AACpC,aAAK,WAAW,EAAE,cAAc,IAAA,CAAK;AAAA,MAAA,CACtC;AACD,WAAK,WAAW;AAAA,IAAA;AAAA,EAClB;AAEJ;"}